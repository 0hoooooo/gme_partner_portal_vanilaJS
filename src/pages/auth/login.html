<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GME Korea Agent Portal</title>
    <link rel="stylesheet" href="../../../src/css/style.css" />
    <link rel="stylesheet" href="../../../src/css/login.css" />
  </head>
  <body>
    <header class="login_header">
      <div class="login_wrapper">
        <div class="login_body">
          <div class="login_column">
            <div class="login_content">
              <span class="login_company">Global Money Express (GME)</span>
              <div class="form_wrapper">
                <div class="inputId_wrapper">
                  <label class="user_input">
                    Username <span style="color: #ed1c24">*</span></label
                  >
                  <input
                    class="username"
                    id="id"
                    type="text"
                    placeholder="Enter Username"
                    onchange="changeValue()"
                  />
                </div>
                <br />
                <div class="inputId_wrapper">
                  <label class="user_input">
                    Password <span style="color: #ed1c24">*</span></label
                  >
                  <input
                    class="username"
                    id="password"
                    type="text"
                    placeholder="Enter Password"
                  />
                </div>
                <label for="login-sign-up" class="login__label--checkbox">
                  <input
                    id="login-remember"
                    type="checkbox"
                    class="login_input_checkbox"
                  />
                  아이디 저장
                </label>
                <button type="submit" class="login_button" onclick="goLogin()">
                  LOGIN
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
  </body>
  <script>
    const idKey = "USER-ID";
    const idInput = document.getElementById("id");
    const pwdInput = document.getElementById("password");
    //아이디 저장 여부 체크박스 엘레먼트(비밀번호는X)
    const chkRemember = document.getElementById("login-remember");
    //로컬스토리지에 저장된 로그인 정보가 있는 경우 세팅하기.
    const loginInfo = localStorage.getItem(idKey);

    function checkId(str_id) {
      //아이디 정규식 체크 함수
      //영문자로 시작해야하는(숫자가 앞으로 올 수 없음) 영문+숫자 조합 5~20자.
      const reg2 = /^[a-z]+[a-z0-9]{4,19}$/g;
      return reg2.test(str_id);
    }
    function checkPwd(str_pwd) {
      //비밀번호 정규식 체크 함수
      //비밀번호는 영어/숫자/특수문자를 포함한 8자 이상.
      console.log(str_pwd);
      const reg1 = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;
      console.log("비밀번호 체크:", reg1.test(str_pwd));
      return reg1.test(str_pwd); //정규식과 매치되면 true, 매치되지않으면 false 반환.
    }

    function checkRemeberLoginInfo() {
      //웹스토리지 이용하여 저장 또는 삭제.

      let userId = idInput.value;

      if (chkRemember.checked == true) {
        localStorage.setItem(idKey, userId);
        alert("아이디값 저장");
        let indexLink = "../../../index.html";
        console.log("login");
        window.location.href = indexLink;
      } else {
        //선택하지않으면 기존에 있던 모든 로그인 정보 삭제.
        localStorage.removeItem(idKey);
        alert("아이디값 저장안함");
      }
    }

    function goLogin() {
      //0.입력값 여부 확인.
      if (checkNullInput(idInput) && checkNullInput(pwdInput)) {
        //값이 모두 입력된 경우

        //1.1 아이디 유효성 검사 + 비밀번호 유효성 검사
        if (checkId(idInput.value) && checkPwd(pwdInput.value)) {
          //모두 유효

          //true 반환되면 아이디 비밀번호 정보 저장 후 formaction으로 보냄.
          checkRemeberLoginInfo();
          return true;
        } else {
          //1.2 모두 또는 일부 유효하지않음.

          alert("아이디 또는 비밀번호를 올바르게 입력해주세요.");
          return false;
        }
      } else {
        //아이디나 비밀번호 둘중 하나, 또는 모두 입력되지않음

        //비어있는 곳으로 포커스.
        if (checkNullInput(idInput) == false) {
          //두개 모두 false인 경우(두개모두 미입력된 경우), 또는 아이디기 false를 반환한 경우(아이디 미입력 경우)

          idInput.focus();
          return false;
        } else {
          //비밀번호 미입력한 경우

          pwdInput.focus();
          return false;
        }
      }
    }
    function changeValue() {
      let value = document.getElementById("id").value;
      console.log(value);
    }

    function checkNullInput(input) {
      //인풋 값 입력 여부를 확인하는 함수 //input element를 파람으로 받는다.

      if (input.value == "") {
        console.log("로그인 정보 미입력");
        return false;
      } else {
        console.log("로그인 정보 입력");
        return true;
      }
    }
  </script>
</html>
